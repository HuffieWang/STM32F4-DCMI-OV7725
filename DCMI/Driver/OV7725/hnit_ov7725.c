/*********************** HNIT 3103 Application Team **************************
 * 文 件 名 ：hnit_ov7725.c
 * 描    述 ：ov7725摄像头驱动        
 * 实验平台 ：STM32F407开发板
 * 库 版 本 ：ST1.4.0
 * 时    间 ：2016.04.08
 * 作    者 ：3103创新团队
 * 修改记录 ：无
******************************************************************************/
#include "hnit_ov7725.h"
#include "hnit_sccb.h"
#include "hnit_dcmi.h"

/* 寄存器参数配置 */
Reg_Info sensor_config[] =
{
  	{0x32,0x00},
	{0x2a,0x00},
	{0x11,0x03},
	{0x12,0x46},//QVGA RGB565
	  
	{0x42,0x7f},
	{0x4d,0x00},
	{0x63,0xf0},
	{0x64,0x1f},
	{0x65,0x20},
	{0x66,0x00},
    
   
	{0x67,0x00},    
 
	{0x69,0x50},  		
	{0x13,0xff},
	{0x0d,0x41},
	{0x0f,0x01},
	{0x14,0x06},
	
	{0x24,0x75},
	{0x25,0x63},
	{0x26,0xd1},
	{0x2b,0xff},
	{0x6b,0xaa},
	
	{0x8e,0x10},
	{0x8f,0x00},
	{0x90,0x00},
	{0x91,0x00},
	{0x92,0x00},
	{0x93,0x00},
	
	{0x94,0x2c},
	{0x95,0x24},
	{0x96,0x08},
	{0x97,0x14},
	{0x98,0x24},
	{0x99,0x38},
	{0x9a,0x9e},
	{0x15,0x00}, 
	{0x9b,0x00},
	{0x9c,0x20},
	{0xa7,0x40},  
	{0xa8,0x40},
	{0xa9,0x80},
	{0xaa,0x80},
	
	{0x9e,0x81},
	{0xa6,0x06},
	
	{0x7e,0x0c},
	{0x7f,0x16},
	{0x80,0x2a},
	{0x81,0x4e},
	{0x82,0x61},
	{0x83,0x6f},
	{0x84,0x7b},
	{0x85,0x86},
	{0x86,0x8e},
	{0x87,0x97},
	{0x88,0xa4},
	{0x89,0xaf},
	{0x8a,0xc5},
	{0x8b,0xd7},
	{0x8c,0xe8},
	{0x8d,0x20},
	
	{0x33,0x40},
	{0x34,0x00},
	{0x22,0xaf},
	{0x23,0x01},
	
	{0x49,0x10},
	{0x4a,0x10},
	{0x4b,0x14},
	{0x4c,0x17},
	{0x46,0x05},
	
	{0x47,0x08},
	{0x0e,0x01},
	{0x0c,0x60},
	{0x09,0x03},
	
	{0x29,0x50},
	{0x2C,0x78},
	   
	{0x00,0x00},
	{0x00,0x00},
	{0x00,0x60},   				
};
u8 OV7725_REG_NUM = sizeof(sensor_config)/sizeof(sensor_config[0]);	  /*结构体数组成员数目*/


/**
  * @brief  OV7725摄像头初始化
  * @param  无
  * @retval SUCCESS: 成功
  *         ERROR  : 失败
  */
ErrorStatus ov7725_init(void)
{
	uint16_t i = 0;
	uint8_t Sensor_IDCode = 0;	
    
    sccb_gpio_config();  
	//DEBUG("ov7725 Register Config Start......");
	   
	if( 0 == sccb_write_byte ( 0x12, 0x80 ) ) /*复位sensor */
	{
        
		//DEBUG("sccb write data error");	
		return ERROR ;
	}	
      
	if( 0 == sccb_read_byte( &Sensor_IDCode, 1, 0x0b ) )	 /* 读取sensor ID号*/
	{
		//DEBUG("read id faild");	
		return ERROR;
	}
	//DEBUG("Sensor ID is 0x%x", Sensor_IDCode);	
	
	if(Sensor_IDCode == OV7725_ID)
	{
		for( i = 0 ; i < OV7725_REG_NUM ; i++ )
		{
			if( 0 == sccb_write_byte(sensor_config[i].Address, sensor_config[i].Value) )
			{      
				//DEBUG("write reg faild", Sensor_Config[i].Address);
				return ERROR;
			}
		}
	}
	else
	{
		return ERROR;
	}
	//DEBUG("ov7725 Register Config Success");
	return SUCCESS;
}



/******************************* END OF FILE *********************************/
